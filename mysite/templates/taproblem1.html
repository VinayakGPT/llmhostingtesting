{% extends "base2.html" %}
{% block title %}Problem 1{% endblock %}

{% block content %}
<form id="taproblem1-form" method="post" novalidate>
    {% csrf_token %}
    <div class="container">
        <br> 
        <h2>1. Tetrahedral</h2>
        <div class="problem-statement">
            <pre class="wrap"><h5><b>Problem Statement:</b></h5>Given an input N (N>0), your program should output the Nth tetrahedral number. To calculate the nth tetrahedral number, T(n), the formula is as follows:
T(n) = (1) + (1+2) + (1+2+3) + (1+2+3+4) + ... + (1+2+3+4+...+n)
Example:
Input:
2
Output:
4
Input:
5
Output: 
35</pre>
        </div>
        <p><pre class="wraptext"><h5><b>Incorrect Solution:</b></h5><code><span class="keyword">#include</span> <span class="string">&lt;stdio.h&gt;</span>
<span class="keyword">int</span> <span class="function">main</span>() {
    <span class="keyword">int</span> n;
    <span class="function">scanf</span>(<span class="string">"%d"</span>, &n);
    <span class="keyword">int</span> sum = 0;
    <span class="keyword">for</span> (<span class="keyword">int</span> i = 1; i &lt;= n; i++) {
        sum += (i * (i + 1)) / 2;
    }
    <span class="function">printf</span>(<span class="string">"%d\n"</span>, sum);
    <span class="keyword">return</span> 0;
}</code></pre></p>


        <ul class="nav nav-tabs" id="feedbackTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="feedback1-tab" data-toggle="tab" href="#feedback1" role="tab" aria-controls="feedback1" aria-selected="true">Feedback 1</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="feedback2-tab" data-toggle="tab" href="#feedback2" role="tab" aria-controls="feedback2" aria-selected="false">Feedback 2</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="feedback3-tab" data-toggle="tab" href="#feedback3" role="tab" aria-controls="feedback3" aria-selected="false">Feedback 3</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="feedback4-tab" data-toggle="tab" href="#feedback4" role="tab" aria-controls="feedback4" aria-selected="false">Feedback 4</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="feedback5-tab" data-toggle="tab" href="#feedback5" role="tab" aria-controls="feedback5" aria-selected="false">Feedback 5</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="feedback6-tab" data-toggle="tab" href="#feedback6" role="tab" aria-controls="feedback6" aria-selected="false">Feedback 6</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="feedback7-tab" data-toggle="tab" href="#feedback7" role="tab" aria-controls="feedback7" aria-selected="false">Feedback 7</a>
            </li>
        </ul>

        
        <div class="tab-content" id="feedbackTabsContent">
            <!-- Feedback 1 -->
            <div class="tab-pane fade show active" id="feedback1" role="tabpanel" aria-labelledby="feedback1-tab">
                <div class="feedback-content"> 
                    <pre class="wrap">

The given solution tries to calculate the sum of triangle numbers using a different logic than the traditional one, but incorrectly uses only the last value of `s` (which holds the triangle number for `n-1`) for the final output due to printing `s` outside the for loop. Logical error: The program incorrectly omits the inclusion of the `n`-th triangle number sum and prints the output incorrectly. It also calculates triangle number sums incorrectly within the loop due to faulty initialization and limits in the loop. The given solution fails to correctly compute and display the aggregate total.
                    </pre>
                     
                    <label for="feedback11_rating">How helpful is the feedback to understand the logical error(s) in the given program?</label>
                    <div class="feedback-rating-container">
                        <div class="feedback-label not-helpful">Not Helpful</div>
            
                        <div class="star-rating mt-3" data-feedback-id="11">
                            <span class="star {% if feedback_data.feedback11 >= 1 %}filled{% endif %}" data-value="1">&#9733;</span>
                            <span class="star {% if feedback_data.feedback11 >= 2 %}filled{% endif %}" data-value="2">&#9733;</span>
                            <span class="star {% if feedback_data.feedback11 >= 3 %}filled{% endif %}" data-value="3">&#9733;</span>
                            <span class="star {% if feedback_data.feedback11 >= 4 %}filled{% endif %}" data-value="4">&#9733;</span>
                            <span class="star {% if feedback_data.feedback11 >= 5 %}filled{% endif %}" data-value="5">&#9733;</span>
                        </div>
            
                        <div class="feedback-label helpful">Very Helpful</div>
                    </div>
                    <input type="hidden" name="feedback11_rating" id="feedback11_rating" value="{{ feedback_data.feedback11 }}">
                    <button class="btn btn-primary next-btn mt-3" data-next-tab="feedback2-tab">Save & Next</button>
                </div>
            </div>
            
            <!-- Feedback 2 -->
            <div class="tab-pane fade" id="feedback2" role="tabpanel" aria-labelledby="feedback2-tab">
                <div class="feedback-content">
                    <pre class="wrap">
                        
The given solution attempts to calculate the summation of triangular numbers using a formula `s = i * (i + 1) / 2` within a loop, and adds these computed values incorrectly. However, a critical flaw in this code is that it outputs `s` which only holds the last calculated triangular number, instead of the intended sum of all triangular numbers up to the n-th, which results in incorrect outputs.
In summary, the incorrect solution fails because it improperly utilizes and recounts only the last triangular number rather than accumulating all required values to yield the tetrahedral number.      
                    </pre>
                    
                    <label for="feedback12_rating">How helpful is the feedback to understand the logical error(s) in the given program?</label>
                    <div class="feedback-rating-container">
                        <div class="feedback-label not-helpful">Not Helpful</div>
            
                        <div class="star-rating mt-3" data-feedback-id="12">
                            <span class="star {% if feedback_data.feedback12 >= 1 %}filled{% endif %}" data-value="1">&#9733;</span>
                            <span class="star {% if feedback_data.feedback12 >= 2 %}filled{% endif %}" data-value="2">&#9733;</span>
                            <span class="star {% if feedback_data.feedback12 >= 3 %}filled{% endif %}" data-value="3">&#9733;</span>
                            <span class="star {% if feedback_data.feedback12 >= 4 %}filled{% endif %}" data-value="4">&#9733;</span>
                            <span class="star {% if feedback_data.feedback12 >= 5 %}filled{% endif %}" data-value="5">&#9733;</span>
                        </div>
            
                        <div class="feedback-label helpful">Very Helpful</div>
                    </div>
                    <input type="hidden" name="feedback12_rating" id="feedback12_rating" value="{{ feedback_data.feedback12 }}">
                    <button class="btn btn-primary next-btn mt-3" data-next-tab="feedback3-tab">Save & Next</button>
                </div>
            </div>

            <!-- Feedback 3 -->
            <div class="tab-pane fade" id="feedback3" role="tabpanel" aria-labelledby="feedback3-tab">
                <div class="feedback-content">
                    <pre class="wrap">
                        
The given solution calculates the sum of the first `i` natural numbers (`s=i*(i+1)/2`) in each iteration of the outer for-loop, and presents the result of the last computation as the output using `printf("%d", s)`. This approach is a misunderstanding, as it outputs only the last triangular number calculated for `(n-1)*(n)/2` rather than the sum of all triangular numbers up to `n`. The main logical error here is that the sum of the computed triangular numbers is not being accurately compiled; `sum` variable is updated but not used in the output (`printf`).
In summary, the final print statement incorrectly uses the variable `s` instead of `sum`, which should represent the total of all triangular numbers up to `n`. The method for accumulating and summing triangular numbers up to `n` is calculated but not utilized properly in the output. This discrepancy leads to incorrect result output and does not align with the requirement to calculate the nth tetrahedral number.
                    </pre>
                    
                    <label for="feedback13_rating">How helpful is the feedback to understand the logical error(s) in the given program?</label>
                    <div class="feedback-rating-container">
                        <div class="feedback-label not-helpful">Not Helpful</div>
            
                        <div class="star-rating mt-3" data-feedback-id="13">
                            <span class="star {% if feedback_data.feedback13 >= 1 %}filled{% endif %}" data-value="1">&#9733;</span>
                            <span class="star {% if feedback_data.feedback13 >= 2 %}filled{% endif %}" data-value="2">&#9733;</span>
                            <span class="star {% if feedback_data.feedback13 >= 3 %}filled{% endif %}" data-value="3">&#9733;</span>
                            <span class="star {% if feedback_data.feedback13 >= 4 %}filled{% endif %}" data-value="4">&#9733;</span>
                            <span class="star {% if feedback_data.feedback13 >= 5 %}filled{% endif %}" data-value="5">&#9733;</span>
                        </div>
            
                        <div class="feedback-label helpful">Very Helpful</div>
                    </div>
                    <input type="hidden" name="feedback13_rating" id="feedback13_rating" value="{{ feedback_data.feedback13 }}">
                    <button class="btn btn-primary next-btn mt-3" data-next-tab="feedback4-tab">Save & Next</button>
                </div>
            </div>

            <!-- Feedback 4 -->
            <div class="tab-pane fade" id="feedback4" role="tabpanel" aria-labelledby="feedback4-tab">
                <div class="feedback-content">
                    <pre class="wrap">
                        
The given solution attempts to calculate the tetrahedral number incorrectly by mistaking the calculation for each triangular number `s` and summing them up. However, the major flaw is that it eventually only prints the last triangular number calculated (`s`) rather than the cumulative sum of these triangular numbers, due to incorrectly placing the `printf` statement outside of the loop and using `s` instead of `sum`. The calculation within the loop doesn't properly sum up the triangular numbers due to error in formula simplification. 
In summary, the given solution prints the value of the last calculated triangular number instead of the cumulative sum of these numbers. It does not follow the correct method to sum the triangular numbers which should be adding up consecutive sums of integers from 1 to i (for each i up to n). This results in mistakenly calculated outputs as the implemented formula and intended usage of `s` as the tetrahedral sum is flawed.
                    </pre>
                    
                    <label for="feedback14_rating">How helpful is the feedback to understand the logical error(s) in the given program?</label>
                    <div class="feedback-rating-container">
                        <div class="feedback-label not-helpful">Not Helpful</div>
            
                        <div class="star-rating mt-3" data-feedback-id="14">
                            <span class="star {% if feedback_data.feedback14 >= 1 %}filled{% endif %}" data-value="1">&#9733;</span>
                            <span class="star {% if feedback_data.feedback14 >= 2 %}filled{% endif %}" data-value="2">&#9733;</span>
                            <span class="star {% if feedback_data.feedback14 >= 3 %}filled{% endif %}" data-value="3">&#9733;</span>
                            <span class="star {% if feedback_data.feedback14 >= 4 %}filled{% endif %}" data-value="4">&#9733;</span>
                            <span class="star {% if feedback_data.feedback14 >= 5 %}filled{% endif %}" data-value="5">&#9733;</span>
                        </div>
            
                        <div class="feedback-label helpful">Very Helpful</div>
                    </div>
                    <input type="hidden" name="feedback14_rating" id="feedback14_rating" value="{{ feedback_data.feedback14 }}">
                    <button class="btn btn-primary next-btn mt-3" data-next-tab="feedback5-tab">Save & Next</button>
                </div>
            </div>
 
            <!-- Feedback 5 -->
            <div class="tab-pane fade" id="feedback5" role="tabpanel" aria-labelledby="feedback5-tab">
                <div class="feedback-content">
                    <pre class="wrap">
                        
The given solution uses a simplified formula attempting to calculate a sum of the series directly by iterating through `i` and computing `s = i*(i+1)/2`, which represents the sum of the first `i` natural numbers. However, it incorrectly attempts to accumulate these intermediate sums into `sum` and mistakenly prints the last value of `s` when the loop finishes, which leads to incorrect outputs for the given problem. The logic error in the given solution stems from its wrong accumulation strategy and final output of `s`, which does not represent the sum of the sums of the sequence needed for tetrahedral numbers. Moreover, it does not correctly calculate the sum of sums (summation of triangular numbers), thus leading to incorrect tetrahedral number calculations for tested inputs.
                    </pre>
                    
                    <label for="feedback15_rating">How helpful is the feedback to understand the logical error(s) in the given program?</label>
                    <div class="feedback-rating-container">
                        <div class="feedback-label not-helpful">Not Helpful</div>
            
                        <div class="star-rating mt-3" data-feedback-id="15">
                            <span class="star {% if feedback_data.feedback15 >= 1 %}filled{% endif %}" data-value="1">&#9733;</span>
                            <span class="star {% if feedback_data.feedback15 >= 2 %}filled{% endif %}" data-value="2">&#9733;</span>
                            <span class="star {% if feedback_data.feedback15 >= 3 %}filled{% endif %}" data-value="3">&#9733;</span>
                            <span class="star {% if feedback_data.feedback15 >= 4 %}filled{% endif %}" data-value="4">&#9733;</span>
                            <span class="star {% if feedback_data.feedback15 >= 5 %}filled{% endif %}" data-value="5">&#9733;</span>
                        </div>
            
                        <div class="feedback-label helpful">Very Helpful</div>
                    </div>
                    <input type="hidden" name="feedback15_rating" id="feedback15_rating" value="{{ feedback_data.feedback15 }}">
                    <button class="btn btn-primary next-btn mt-3" data-next-tab="feedback6-tab">Save & Next</button>
                </div>
            </div>
            <!-- Feedback 6 -->
            <div class="tab-pane fade" id="feedback6" role="tabpanel" aria-labelledby="feedback6-tab">
                <div class="feedback-content">
                    <pre class="wrap">
                        
{{ ta1_feedback1 }}
                    </pre>
                     
                    <label for="feedback16_rating">How helpful is the feedback to understand the logical error(s) in the given program?</label>
                    <div class="feedback-rating-container">
                        <div class="feedback-label not-helpful">Not Helpful</div>
            
                        <div class="star-rating mt-3" data-feedback-id="16">
                            <span class="star {% if feedback_data.feedback16 >= 1 %}filled{% endif %}" data-value="1">&#9733;</span>
                            <span class="star {% if feedback_data.feedback16 >= 2 %}filled{% endif %}" data-value="2">&#9733;</span>
                            <span class="star {% if feedback_data.feedback16 >= 3 %}filled{% endif %}" data-value="3">&#9733;</span>
                            <span class="star {% if feedback_data.feedback16 >= 4 %}filled{% endif %}" data-value="4">&#9733;</span>
                            <span class="star {% if feedback_data.feedback16 >= 5 %}filled{% endif %}" data-value="5">&#9733;</span>
                        </div>
            
                        <div class="feedback-label helpful">Very Helpful</div>
                    </div>
                    <input type="hidden" name="feedback16_rating" id="feedback16_rating" value="{{ feedback_data.feedback16 }}">
                    <button class="btn btn-primary next-btn mt-3" data-next-tab="feedback7-tab">Save & Next</button>
                </div>
            </div>

            <!-- Feedback 7 -->
            <div class="tab-pane fade" id="feedback7" role="tabpanel" aria-labelledby="feedback7-tab">
                <div class="feedback-content">
                    <pre class="wrap">
                        
{{ ta2_feedback1 }}
                    </pre>
                    
                    <label for="feedback17_rating">How helpful is the feedback to understand the logical error(s) in the given program?</label>
                    <div class="feedback-rating-container">
                        <div class="feedback-label not-helpful">Not Helpful</div>
            
                        <div class="star-rating mt-3" data-feedback-id="17">
                            <span class="star {% if feedback_data.feedback17 >= 1 %}filled{% endif %}" data-value="1">&#9733;</span>
                            <span class="star {% if feedback_data.feedback17 >= 2 %}filled{% endif %}" data-value="2">&#9733;</span>
                            <span class="star {% if feedback_data.feedback17 >= 3 %}filled{% endif %}" data-value="3">&#9733;</span>
                            <span class="star {% if feedback_data.feedback17 >= 4 %}filled{% endif %}" data-value="4">&#9733;</span>
                            <span class="star {% if feedback_data.feedback17 >= 5 %}filled{% endif %}" data-value="5">&#9733;</span>
                        </div>
            
                        <div class="feedback-label helpful">Very Helpful</div>
                    </div>  
                    <input type="hidden" name="feedback17_rating" id="feedback17_rating" value="{{ feedback_data.feedback17 }}">
                    <button type="submit" class="btn btn-primary">Next Problem</button>
                </div>
            </div>
        </div>
    </div>
</form>

<nav aria-label="Page navigation example" class="mt-4">
    <ul class="pagination justify-content-center">
        <li class="page-item {% if 1 not in visited_pages %}disabled{% endif %}">
            <a class="page-link" href="{% url 'taproblem1' 1 %}">1</a>
        </li>
        <li class="page-item {% if 2 not in visited_pages %}disabled{% endif %}">
            <a class="page-link" href="{% url 'taproblem2' 2 %}">2</a>
        </li>
        <li class="page-item {% if 3 not in visited_pages %}disabled{% endif %}">
            <a class="page-link" href="{% url 'taproblem3' 3 %}">3</a>
        </li>
        <li class="page-item {% if 4 not in visited_pages %}disabled{% endif %}">
            <a class="page-link" href="{% url 'taproblem4' 4 %}">4</a>
        </li>
        <li class="page-item {% if 5 not in visited_pages %}disabled{% endif %}">
            <a class="page-link" href="{% url 'taproblem5' 5 %}">5</a>
        </li>
        <li class="page-item {% if 6 not in visited_pages %}disabled{% endif %}">
            <a class="page-link" href="{% url 'taproblem6' 6 %}">6</a>
        </li>
        <li class="page-item {% if 7 not in visited_pages %}disabled{% endif %}">
            <a class="page-link" href="{% url 'taproblem7' 7 %}">7</a>
        </li>
    </ul>
</nav>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const tabs = document.querySelectorAll('.nav-item .nav-link');
        
        // Check if it's the user's first visit
        const isFirstVisit1 = localStorage.getItem('firstVisit1') === null;

        if (isFirstVisit1) {
            // Disable all tabs except the first one on the first visit
            tabs.forEach((tab, index) => {
                if (index !== 0) {
                    tab.classList.add('disabled');
                }
            });
        } 
        else {
            // Enable all previously unlocked tabs
            tabs.forEach((tab, index) => {
                const tabId = tab.getAttribute('href').substring(1); // Get tab pane ID
                const isTabUnlocked = localStorage.getItem(`tabUnlocked_${tabId}`) === 'true';

                if (isTabUnlocked || index === 0) {
                    tab.classList.remove('disabled');
                }
            });
        }

        function checkAllFeedbackRatings() {
            const unfilledFeedback = [];

            document.querySelectorAll('.tab-pane').forEach(tab => {
                const hiddenInputs = tab.querySelectorAll('input[type="hidden"]');

                hiddenInputs.forEach(hiddenInput => {
                    const feedbackId = hiddenInput.getAttribute('name').match(/\d+/)[0];
                    const selectedRating = hiddenInput.value;

                    if (!selectedRating || selectedRating === '0') {
                        unfilledFeedback.push(`Feedback ${feedbackId.charAt(feedbackId.length - 1)}`);
                    }
                });
            });

            return unfilledFeedback;
        }

        document.querySelector('.btn-primary[type="submit"]').addEventListener('click', (e) => {
            const unfilledFeedback = checkAllFeedbackRatings();

            if (unfilledFeedback.length > 0) {
                alert(`Please rate these feedbacks to move on to the next problem: ${unfilledFeedback.join(', ')}`);
                e.preventDefault();
            } else {
                // Mark the page as visited
                localStorage.setItem('firstVisit1', 'true');
            }
        });

        document.querySelectorAll('.next-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
        
                // Identify the current tab pane
                const currentTabPane = button.closest('.tab-pane');
                const feedbackItems = currentTabPane.querySelectorAll('.star-rating');
                const unfilledFeedback = [];
        
                // Check each feedback item on the current tab
                feedbackItems.forEach(feedback => {
                    const feedbackId = feedback.getAttribute('data-feedback-id');
                    const savedRating = localStorage.getItem(`feedback${feedbackId}_rating`);
        
                    if (!savedRating || savedRating === '0') {
                        unfilledFeedback.push(`Feedback ${feedbackId}`);
                    }
                });
        
                // If there are unfilled feedback items, alert and stop execution
                if (unfilledFeedback.length > 0) {
                    alert(`Please rate the given feedback before moving to the next tab`);
                    return;
                }
        
                // Proceed to unlock the next tab if all ratings are filled
                const nextTabId = button.getAttribute('data-next-tab');
                const nextTab = document.getElementById(nextTabId);
        
                if (nextTab) {
                    nextTab.classList.remove('disabled');
                    localStorage.setItem(`tabUnlocked_${nextTabId}`, 'true');
        
                    const currentTab = currentTabPane.id;
                    const currentNavLink = document.querySelector(`[href="#${currentTab}"]`);
                    currentNavLink.classList.remove('disabled');
        
                    nextTab.click();
                }
            });
        });

        // Handle star ratings and save them in localStorage
        document.querySelectorAll('.star-rating').forEach(starRatingDiv => {
            const feedbackId = starRatingDiv.getAttribute('data-feedback-id');
            const hiddenInput = document.querySelector(`input[name='feedback${feedbackId}_rating']`);

            if (!hiddenInput) {
                console.error(`Hidden input for feedback ${feedbackId} not found`);
                return;
            }

            // Load saved rating from localStorage (if available)
            const savedRating = localStorage.getItem(`feedback${feedbackId}_rating`);
            if (savedRating) {
                hiddenInput.value = savedRating;

                const stars = Array.from(starRatingDiv.querySelectorAll('.star'));
                for (let i = 0; i < savedRating; i++) {
                    stars[i].classList.add('filled');
                }
            }

            starRatingDiv.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', () => {
                    const value = star.getAttribute('data-value');
                    const stars = Array.from(star.parentElement.children);

                    stars.forEach(s => s.classList.remove('filled'));

                    for (let i = 0; i < value; i++) {
                        stars[i].classList.add('filled');
                    }

                    hiddenInput.value = value;

                    // Save rating to localStorage
                    localStorage.setItem(`feedback${feedbackId}_rating`, value);
                });
            }); 
        });

        // Prevent navigation to disabled tabs
        tabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                if (tab.classList.contains('disabled')) {
                    e.preventDefault();
                }
            });
        });

        // Enable the first tab initially
        tabs[0].classList.remove('disabled');
    });
</script>


<style>
    
    .feedback-rating-container {
        display: flex;
        align-items: baseline; 
        justify-content: center; 
        margin-top: 1rem; 
    }
    
    .star-rating .star {
        font-size: 30px; 
        color: #ddd; 
        cursor: pointer;
        transition: color 0.2s;
    }
    
    .mt-3, .my-3 {
        margin-top: 1rem !important;
        text-align: center;
    }
    
    .star-rating .star.filled {
        color: #ffc107; 
    }
    
    .not-helpful {
        color: red;
        position: relative;
        right: 0.6rem;
        bottom: 0.2rem;
        font-weight: 600;
    }
    
    .helpful {
        color: green;
        position: relative;
        left: 0.6rem;
        bottom: 0.2rem;
        font-weight: 600;
    }

label {
    font-weight: 600;
}

</style>

{% endblock %}
