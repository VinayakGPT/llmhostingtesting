<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}
    <title>{% block title %}Problem{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="{% static 'iitk_logo1.png' %}">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.6;
            margin: 0; 
            padding: 0;
            background-color: #d0f0fb;
            color: #333;
        }

        .container {
            max-width: 1050px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #1976d2;
            margin-bottom: 20px;
            font-weight: bold;
        }

        h5 {
            color: #e13e11;
            font-weight: bold;
        }

        .btn-primary {
            background-color: #0277bd;
            border-color: #0277bd;
            color: white;
            transition: background-color 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #005b9f;
        }

        .pagination .page-link {
            color: #0277bd;
            transition: color 0.3s ease;
        }

        .pagination .page-link:hover {
            color: #01579b;
        }

        .wrap {
            white-space: pre-wrap;
            position: relative;
            top: 10px;
        }

        .wraptext {
            white-space: pre-wrap;
            background-color: #ffffff;
            color: #000000;
            padding: 15px 30px; 
            border-radius: 35px;
            font-family: "Courier New", Courier, monospace;
            line-height: 1.5;
            font-size: medium;
            border: 7px solid #f8d7da;
            box-shadow: 0 0 10px rgba(248, 215, 218, 0.5); 
        }

        .problem-statement, .feedback, .feedback1, .feedback2, .feedback3, .feedback4, .feedback5 {
            display: flex;
            flex-direction: column;
            justify-content: flex-start; 
            padding: 15px 30px; 
            background-color: #f2f2f2;
            border-radius: 35px;
            font-family: "Courier New", Courier, monospace;
            line-height: 1.7;
        }

        .wraptext .keyword {
            color: #023d94;
        } 

        .wraptext .comment {
            color: #c96129;
        }

        .wraptext .string {
            color: #b00287;
        }

        .wraptext .number {
            color: #ae81ff;
        }

        .wraptext .function {
            color: #76ae07;
        }

        .form-group {
            margin-bottom: 20px;
            margin-top: 40px;
        }

        .hidden {
            display: none;
        }

        .navbar-dark {
            background-color: #0c0f1f !important;
        }
        .navbar-nav .nav-link { 
            color: #c0c0c0; 
            transition: color 0.3s ease;
        }
        .navbar-nav .nav-link.active, .navbar-nav .nav-link:hover {
            color: white; 
        }
        .navbar-brand, .navbar-brand:hover {
            color: #f8f9fa;
        }

        .navbar-toggler {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .styled-textbox {
            width: 100%;            /* Ensure it takes full width */
            height: 200px;           /* Set a reasonable height */
            padding: 10px;           /* Add padding inside the text area */
            text-align: left;        /* Ensure text aligns to the left */
            white-space: normal;     /* Make sure wrapping is normal */
            word-wrap: break-word;   /* Force long words to wrap */
            resize: vertical;        /* Allow vertical resizing (optional) */
        }

        .locked {
            pointer-events: none; 
            opacity: 0.5; 
            cursor: not-allowed; 
        }
    </style>
</head>
<body>
    {% block navbar %}
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
          <a href="https://www.iitk.ac.in/" target="_blank" class="navbar-brand d-flex align-items-center">
            <img src="{% static 'iitk_logo1.png' %}" alt="IITK Logo" style="height: 50px; margin-right: 10px;">
            <b>IIT Kanpur</b>
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="{% url 'index' %}">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'contact' %}">Contact</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'admin_control_panel' %}">Admin</a>
            </li>
            </ul>
          </div>
        </div>
      </nav>
      {% endblock %}

    <div class="container mt-5">
        {% block content %}{% endblock %}
    </div>

    <footer class="py-3 my-4">
        <ul class="nav justify-content-center border-bottom pb-3 mb-3">
          <li class="nav-item"><a href="{% url 'index' %}" class="nav-link px-2 text-muted">Home</a></li>
          <li class="nav-item"><a href="{% url 'contact' %}" class="nav-link px-2 text-muted">Contact</a></li>
        </ul>
        <p class="text-center text-muted">
          <a href="https://www.iitk.ac.in/" target="_blank"> Indian Institute of Technology, Kanpur </a>
        </p>
      </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.querySelector('form');
            if (form) {
                const showFeedbackButtons = [
                    document.getElementById('show-feedback-btn1'),
                    document.getElementById('show-feedback-btn2'),
                    document.getElementById('show-feedback-btn3'),
                    document.getElementById('show-feedback-btn4'),
                    document.getElementById('show-feedback-btn5'),
                    document.getElementById('show-feedback-btn6'),
                    document.getElementById('show-feedback-btn7')
                ];
    
                showFeedbackButtons.forEach((button, index) => {
                    if (!button) {
                        console.error(`Button with ID show-feedback-btn${index + 1} not found!`);
                        return; 
                    }
    
                    button.addEventListener('click', () => {
                        const problemIndex = index + 1;
                        console.log(`Show Feedback button for Problem ${problemIndex} clicked!`);
                        localStorage.setItem(`buttonClickedProblem${problemIndex}`, 'true');
                        showFeedback(problemIndex); 
                    });
                });
    
                // Ensure starRatingGroups and radios2 are defined
                const starRatingGroups = form.querySelectorAll('.star-rating'); 
                const radios2 = form.querySelectorAll('input[name^="error_description_"][name$="1"]'); 
    
                function checkForPreviousFeedback(problemIndex) {
                    const isButtonClicked = localStorage.getItem(`buttonClickedProblem${problemIndex}`) === 'true';
    
                    const anyStarRated = Array.from(starRatingGroups).some(group => {
                        const hiddenInput = group.nextElementSibling;
                        return hiddenInput && hiddenInput.value !== "0";
                    });
    
                    const anyRadio2Checked = Array.from(radios2).some(radio => radio.checked);
    
                    if (anyStarRated && anyRadio2Checked && isButtonClicked) {
                        console.log(`Feedback for Problem ${problemIndex} should be shown.`);
                        showFeedback(problemIndex); // Show feedback for the specific problem
                    }
                }
    
                function showFeedback(problemIndex) {
                    const anyStarRated = Array.from(starRatingGroups).some(group => {
                        const hiddenInput = group.nextElementSibling;
                        return hiddenInput && hiddenInput.value !== "0"; 
                    });
                    const anyRadio2Checked = Array.from(radios2).some(radio => radio.checked); 
                    const isButtonClicked = localStorage.getItem(`buttonClickedProblem${problemIndex}`) === 'true';
    
                    console.log(`Problem ${problemIndex} - anyStarRated: ${anyStarRated}, anyRadio2Checked: ${anyRadio2Checked}, isButtonClicked: ${isButtonClicked}`);
    
                    const content = document.getElementById(`conditional-content${problemIndex}`);
                    if (!content) {
                        console.error(`Content for Problem ${problemIndex} not found!`);
                        return;
                    }
    
                    // If both conditions are met, show the feedback for the specific problem
                    if (anyStarRated && anyRadio2Checked && isButtonClicked) {
                        content.classList.remove('hidden'); 
                        lockStarRatings(); 
                        lockRadios(); 
                        showFeedbackButtons[problemIndex - 1].disabled = true; 
                    } else {
                        content.classList.add('hidden'); 
                        alert('Please respond to both the questions before revealing feedback.'); 
                    }
                }
    
                function lockStarRatings() {
                    const firstStarRatingGroup = starRatingGroups[0]; 
                    const stars = firstStarRatingGroup.querySelectorAll('.star'); 
    
                    stars.forEach(star => {
                        star.classList.add('locked');  
                        star.removeEventListener('click', handleStarClick);  
                    });
                }
    
                function lockRadios() {
                    radios2.forEach(radio => {
                        radio.classList.add('locked');
                        radio.addEventListener('click', preventChange);
                    });
                }
    
                function preventChange(event) {
                    if (event.target.classList.contains('locked')) {
                        event.preventDefault();
                    }
                }
    
                function handleStarClick(event) {
                    const clickedStar = event.target;
                    const starGroup = clickedStar.closest('.star-rating');
                    const stars = starGroup.querySelectorAll('.star');
                    const ratingValue = clickedStar.getAttribute('data-value');
    
                    stars.forEach(star => {
                        if (star.getAttribute('data-value') <= ratingValue) {
                            star.classList.add('active');
                        } else {
                            star.classList.remove('active');
                        }
                    });
    
                    const hiddenInput = starGroup.nextElementSibling;
                    if (hiddenInput) {
                        hiddenInput.value = ratingValue;
                    }
                }
    
                starRatingGroups.forEach(group => {
                    const stars = group.querySelectorAll('.star');
                    stars.forEach(star => {
                        star.addEventListener('click', handleStarClick);
                    });
                });
    
                for (let i = 1; i <= 7; i++) {
                    checkForPreviousFeedback(i); 
                }
            } else {
                console.error('Form not found!');
            }
        });
    </script>
</body>
</html>